<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ztman.admin.mapper.SysTenantMapper">

    <!-- 通用返回对象 -->
    <resultMap type="com.ztman.admin.api.entity.SysTenant" id="sysTenantResult">
        <result property="tenantId" column="tenant_id"/> <!-- 租户id -->
        <result property="tenantName" column="tenant_name"/> <!-- 租户名称 -->
        <result property="tenantCode" column="tenant_code"/> <!-- 租户编码 -->
        <result property="tenantParent" column="tenant_parent"/> <!-- 上级租户 -->
        <result property="areaId" column="area_id"/> <!-- 所属区域id -->
        <result property="admin" column="admin"/> <!-- 所属（管理员，用户） -->
        <result property="adminPhone" column="admin_phone"/> <!-- 联系方式 -->
        <result property="createBy" column="create_by"/> <!-- 创建人 -->
        <result property="createTime" column="create_time"/> <!-- 创建时间 -->
        <result property="updateBy" column="update_by"/> <!-- 修改人 -->
        <result property="updateTime" column="update_time"/> <!-- 修改时间 -->
        <result property="delFlag" column="del_flag"/> <!-- 删除标识 0-删除，1-正常 -->
        <result property="remark" column="remark"/> <!-- 备注 -->
        <result property="tenantFlag" column="tenant_flag"/> <!-- 有效标识 1-正常 0-停用 2-锁定 -->
    </resultMap>
    <!-- 通用返回对象 -->
    <resultMap type="com.ztman.admin.api.dto.SysTenantDTO" id="sysTenantResultDTO">
        <result property="tenantId" column="tenant_id"/> <!-- 租户id -->
        <result property="tenantName" column="tenant_name"/> <!-- 租户名称 -->
        <result property="tenantCode" column="tenant_code"/> <!-- 租户编码 -->
        <result property="tenantParent" column="tenant_parent"/> <!-- 上级租户 -->
        <result property="areaId" column="area_id"/> <!-- 所属区域id -->
        <result property="admin" column="admin"/> <!-- 所属（管理员，用户） -->
        <result property="adminPhone" column="admin_phone"/> <!-- 联系方式 -->
        <result property="createBy" column="create_by"/> <!-- 创建人 -->
        <result property="createTime" column="create_time"/> <!-- 创建时间 -->
        <result property="updateBy" column="update_by"/> <!-- 修改人 -->
        <result property="remark" column="remark"/> <!-- 备注 -->
        <result property="updateTime" column="update_time"/> <!-- 修改时间 -->
        <result property="delFlag" column="del_flag"/> <!-- 删除标识 0-删除，1-正常 -->
        <result property="tenantFlag" column="tenant_flag"/> <!-- 有效标识 1-正常 0-停用 2-锁定 -->
        <result property="createName" column="createName"/> <!-- 创建人姓名 -->
        <result property="adminName" column="adminName"/> <!-- 管理员姓名 -->
        <result property="areaName" column="areaName"/> <!-- 区域名称 -->
    </resultMap>
    <resultMap type="com.ztman.admin.api.vo.OrganTenantVO" id="OrganTenantVOResult">
        <result property="serviceId" column="service_id"/> <!-- 租户id -->
        <result property="organId" column="organ_id"/> <!-- 租户id -->
        <result property="serviceName" column="service_name"/> <!-- 租户id -->
        <result property="organName" column="organName"/> <!-- 租户id -->
        <result property="administrativeOrganId" column="administrative_organ_id"/> <!-- 租户id -->
    </resultMap>


    <sql id="selectSysTenantVo">
        select tenant.tenant_id,
        tenant.tenant_name,
        tenant.tenant_code,
        tenant.tenant_parent,
        tenant.area_id,
        tenant.admin,
        area.area_name areaName,
        us.user_realname adminName,
        tenant.admin_phone,
        tenant.create_by,
        tenant.create_time,
        tenant.update_by,
        tenant.update_time,
        tenant.del_flag,
        tenant.tenant_flag,
        tenant.remark,
        usby.user_realname createName
        from sys_tenant tenant
        left join  sys_user us on us.user_id = tenant.admin
        left join sys_user usby on usby.user_id = tenant.create_by
        left join sys_administrative_area area on area.area_id = tenant.area_id
    </sql>
    <!-- 查询对象List -->
    <select id="selectSysTenantList" parameterType="SysTenant" resultMap="sysTenantResult">
        <include refid="selectSysTenantVo"/>
        <where>
            <include refid="equal"/>
        </where>
    </select>

    <!-- 模糊查询对象List -->
    <select id="selectSysTenantListByLike" parameterType="com.ztman.admin.api.dto.SysTenantDTO" resultMap="sysTenantResultDTO">
        <include refid="selectSysTenantVo"/>
        <where>
            <include refid="like"/>
        </where>
        order by tenant.create_time desc
    </select>

    <!-- 根据主键查询对象 -->
    <select id="selectSysTenantById" parameterType="Integer" resultMap="sysTenantResultDTO">
        <include refid="selectSysTenantVo"/>
        where tenant.tenant_id = #{tenantId}
    </select>


    <update id="updateSysTenant" parameterType="SysTenant">
        update sys_tenant
        <trim prefix="SET" suffixOverrides=",">
            <if test="tenantName != null  and tenantName != ''  ">tenant_name = #{tenantName},</if>
            <if test="tenantCode != null  and tenantCode != ''  ">tenant_code = #{tenantCode},</if>
            <if test="tenantParent != null  and tenantParent != ''  ">tenant_parent = #{tenantParent},</if>
            <if test="areaId != null  ">area_id = #{areaId},</if>
            <if test="admin != null  and admin != ''  ">admin = #{admin},</if>
            <if test="adminPhone != null  and adminPhone != ''  ">admin_phone = #{adminPhone},</if>
            <if test="createBy != null  ">create_by = #{createBy},</if>
            <if test="createTime != null  ">create_time = #{createTime},</if>
            <if test="updateBy != null  ">update_by = #{updateBy},</if>
            <if test="updateTime != null  ">update_time = #{updateTime},</if>
            <if test="delFlag != null  and delFlag != ''  ">del_flag = #{delFlag},</if>
            <if test="tenantFlag != null  and tenantFlag != ''  ">tenant_flag = #{tenantFlag},</if>
            <if test="remark != null  and remark != ''  ">remark = #{remark},</if>
        </trim>
        where tenant_id = #{tenantId}
    </update>

    <delete id="deleteSysTenantById" parameterType="Integer">
        delete from sys_tenant where tenant_id = #{tenantId}
    </delete>

    <delete id="deleteSysTenantByIds" parameterType="String">
        delete from sys_tenant where tenant_id in
        <foreach item="tenantId" collection="array" open="(" separator="," close=")">
            #{tenantId}
        </foreach>
    </delete>

    <select id="findSysTenantByempno" resultMap="sysTenantResult">

 select tenant.tenant_id,
        tenant.tenant_name,
        tenant.tenant_code,
        tenant.tenant_parent,
        tenant.area_id,
        tenant.admin,
        tenant.admin_phone,
        tenant.create_by,
        tenant.create_time,
        tenant.update_by,
        tenant.update_time,
        tenant.del_flag,
        tenant.tenant_flag,
        tenant.remark

        from sys_tenant tenant where tenant_code = #{tenantCode}

    </select>

    <!-- 新增对象 -->
    <insert id="insertSysTenant" parameterType="SysTenant">
        insert into sys_tenant
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="tenantId != null  ">tenant_id,</if>
            <if test="tenantName != null  and tenantName != ''  ">tenant_name,</if>
            <if test="tenantCode != null  and tenantCode != ''  ">tenant_code,</if>
            <if test="tenantParent != null  and tenantParent != ''  ">tenant_parent,</if>
            <if test="areaId != null  ">area_id,</if>
            <if test="admin != null  and admin != ''  ">admin,</if>
            <if test="adminPhone != null  and adminPhone != ''  ">admin_phone,</if>
            <if test="createBy != null  ">create_by,</if>
            <if test="createTime != null  ">create_time,</if>
            <if test="updateBy != null  ">update_by,</if>
            <if test="updateTime != null  ">update_time,</if>
            <if test="delFlag != null  and delFlag != ''  ">del_flag,</if>
            <if test="tenantFlag != null  and tenantFlag != ''  ">tenant_flag,</if>
            <if test="remark != null  and remark != ''  ">remark,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="tenantId != null  ">#{tenantId},</if>
            <if test="tenantName != null  and tenantName != ''  ">#{tenantName},</if>
            <if test="tenantCode != null  and tenantCode != ''  ">#{tenantCode},</if>
            <if test="tenantParent != null  and tenantParent != ''  ">#{tenantParent},</if>
            <if test="areaId != null  ">#{areaId},</if>
            <if test="admin != null  and admin != ''  ">#{admin},</if>
            <if test="adminPhone != null  and adminPhone != ''  ">#{adminPhone},</if>
            <if test="createBy != null  ">#{createBy},</if>
            <if test="createTime != null  ">#{createTime},</if>
            <if test="updateBy != null  ">#{updateBy},</if>
            <if test="updateTime != null  ">#{updateTime},</if>
            <if test="delFlag != null  and delFlag != ''  ">#{delFlag},</if>
            <if test="tenantFlag != null  and tenantFlag != ''  ">#{tenantFlag},</if>
            <if test="remark != null  and remark != ''  ">#{remark},</if>
        </trim>
    </insert>


    <!-- Where精确匹配字段 -->
    <sql id="equal">
        <if test="tenantId != null ">
            AND tenant.tenant_id = #{tenantId}  <!-- 租户id -->
        </if>
        <if test="tenantName != null and tenantName != ''">
            AND tenant.tenant_name = #{tenantName}  <!-- 租户名称 -->
        </if>
        <if test="tenantCode != null and tenantCode != ''">
            AND tenant.tenant_code = #{tenantCode}  <!-- 租户编码 -->
        </if>
        <if test="tenantParent != null and tenantParent != ''">
            AND tenant.tenant_parent = #{tenantParent}  <!-- 上级租户 -->
        </if>
        <if test="areaId != null ">
            AND tenant.area_id = #{areaId}  <!-- 所属区域id -->
        </if>
        <if test="admin != null and admin != ''">
            AND tenant.admin = #{admin}  <!-- 所属（管理员，用户） -->
        </if>
        <if test="adminPhone != null and adminPhone != ''">
            AND tenant.admin_phone = #{adminPhone}  <!-- 联系方式 -->
        </if>
        <if test="createBy != null ">
            AND tenant.create_by = #{createBy}  <!-- 创建人 -->
        </if>
        <if test="createTime != null ">
            AND tenant.create_time = #{createTime}  <!-- 创建时间 -->
        </if>
        <if test="updateBy != null ">
            AND tenant.tenant.update_by = #{updateBy}  <!-- 修改人 -->
        </if>
        <if test="updateTime != null ">
            AND tenant.update_time = #{updateTime}  <!-- 修改时间 -->
        </if>
        <if test="delFlag != null and delFlag != ''">
            AND tenant.del_flag = #{delFlag}  <!-- 删除标识 0-删除，1-正常 -->
        </if>
        <if test="tenantFlag != null and tenantFlag != ''">
            AND tenant.tenant_flag = #{tenantFlag}  <!-- 有效标识 1-正常 0-停用 2-锁定 -->
        </if>
    </sql>

    <!-- Where模糊匹配字段 -->
    <sql id="like">
        <if test="tenantName != null and tenantName != ''">
            AND tenant.tenant_name like '%${tenantName}%'  <!-- 租户名称 -->
        </if>
        <if test="tenantCode != null and tenantCode != ''">
            AND tenant.tenant_code like '%${tenantCode}%'  <!-- 租户编码 -->
        </if>
        <if test="tenantParent != null and tenantParent != ''">
            AND tenant.tenant_parent like '%${tenantParent}%'  <!-- 上级租户 -->
        </if>
        <if test="adminPhone != null and adminPhone != ''">
            AND tenant.admin_phone like '%${adminPhone}%'  <!-- 联系方式 -->
        </if>
        <if test="adminName != null and adminName != ''">
            AND    us.user_realname like '%${adminName}%'  <!-- 管理员名称 -->
        </if>
        <if test="tenantFlag != null and tenantFlag != ''">
            AND    tenant.tenant_flag  = #{tenantFlag}
        </if>
    </sql>
    <select id="selectOrgan" resultMap="OrganTenantVOResult">
        select
        organ.organ_id,
        organ.name organName,
        service.service_id,
        service.service_name,
        administrative_organ_id
        from  sys_administrative_organ organ
        left join sys_company company  on organ.com_id = company.com_id
        left join sys_service_organ service on service.administrative_organ_id = organ.organ_id
        where company.tenant_id = #{tenantId} and organ.del_flag='1' and company.del_flag = '1' and service.del_flag='1'

    </select>
</mapper>
